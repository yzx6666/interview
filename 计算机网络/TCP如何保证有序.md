# TCP保证有序

**主机每次发送数据时，TCP就给每个数据包分配一个序列号并且在特定的时间内等待接收主机对分配的这个序列号进行确认，如果发送主机在特定时间内没有接收到接收主机的确认，则发送住机会重传此数据包。接受主机利用序列号对接收到数据进行确认，以便检测对方发送的数据是否有丢失或者乱序等，接收主机一旦收到已经顺序化的数据，他就将这些数据按正确的顺序重组成数据流并传递到高层处理。**

## 具体步骤
1.  **为了保证数据包的可靠传递，发送方必须把已经发送的数据保留在缓冲区；**
2.  **并为每个已发送到书纪宝启动一个超时定时器；**
3.  **如在定时器超时之前收到对方发来的应答信息，则是放该数据占用的缓存区**
4.  **否则重传该数据包，知道收到应答或重传次数达到规定的最大次数为止**
5.  **接收方收到数据包后，先进行CRC校验，如果正确则把数据交给上层协议，然后给发送方发送一个累计应答包，表明该数据已收到，如果接收方正好也有数据要发给发送方，应答包也可方在数据包中捎带过去。**

## 超时重传

**TCP可靠性中最重要的一个机制是处理数据超时和重传。TCP协议要求在发送端每发送一个报文段，就启动一个定时器并等待确认信息；接收端成功接收新数据后返回确认信息。若在定时器超时前数据未能被确认，TCP就认为报文段中的数据已丢失或损坏，需要对报文段中的数据重新组织和重传。**