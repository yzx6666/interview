# TCP的TIME_WAIT

**在TCP的四次握手过程中，当主动关闭连接方向被动方发送最后一个ACK后，连接就关闭了，这时，主动方会进入一个特殊的TIME_WAIT状态。**<br/>
**他表示TCP在完全关闭一个连接之前，需要经过2MSL的等待。这个状态的出现是为了确保数据包在网络中的可靠传输，防止数据包的丢失和重复**

## 什么是MSL
**MSL是“最长报文段寿命”，他是任何报文在网络上存在的最长时间，超过这个时间报文将被丢弃**

## 为什么客户端连接要等待2MSL的时间才能完全关闭
**为了保证客户端发送的最后一个ACK报文段能够到达服务器。因为这个ACK有可能丢失，从而导致处在LAST_ACK状态的服务器收不到对FIN_ACK的确认报文。服务器会超时重传这个FIN_ACK，接着客户端在重传一次确认，重新启动时间等待计时器。最后客户端和服务端都能正常的关闭。假设不等待2MSL，而是在发送完ACK之后直接释放关闭，一旦这个ACK丢失的话，服务器就无法正常的进入关闭连接状态。**

## 为什么一定要2MSL
**客户端给服务端发送ACK=1丢失，<font color = red>服务端等待1MSL没有收到，然后重新发送需要1MSL</font>。如果再次就受到服务端的消息，则重启2MSL计时器，发送确认请求。客户端只需等待2MSL，如果没有再次收到服务端的消息，就说明服务端已经接收到自己确认消息；此时双方都关闭连接，TCO四次挥手完毕**